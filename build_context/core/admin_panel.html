<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° GODBRAIN QUANTUM - Command Center</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --primary: #00ff88;
            --secondary: #00cc6a;
            --danger: #ff4444;
            --warning: #ffaa00;
            --bg-dark: #0a0a0a;
            --bg-panel: #12121a;
            --bg-hover: #1a1a2e;
            --border: #2a2a3e;
            --text: #e0e0e0;
            --text-dim: #888;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(180deg, rgba(0,255,136,0.1) 0%, transparent 100%);
            border-bottom: 2px solid var(--primary);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,255,136,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 24px;
            color: var(--primary);
            text-shadow: 0 0 20px var(--primary);
            letter-spacing: 2px;
        }
        
        .header-status {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-online {
            background: rgba(0,255,136,0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--primary); }
            50% { opacity: 0.7; box-shadow: 0 0 20px var(--primary); }
        }
        
        /* Navigation */
        .nav {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 0 30px;
            display: flex;
            gap: 5px;
            overflow-x: auto;
        }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dim);
            position: relative;
        }
        
        .nav-item:hover {
            color: var(--primary);
            background: rgba(0,255,136,0.05);
        }
        
        .nav-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(0,255,136,0.1);
        }
        
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s;
        }
        
        .nav-item.active::after {
            width: 100%;
        }
        
        /* Main Content */
        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 20px;
        }
        
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        /* Panels */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .panel:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 25px rgba(0,255,136,0.2);
            transform: translateY(-2px);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .panel-content {
            color: var(--text);
        }
        
        /* Metrics */
        .metric {
            text-align: center;
            padding: 20px;
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary);
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* Status Cards */
        .status-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0,255,136,0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .status-card:hover {
            background: rgba(0,255,136,0.1);
            border-color: var(--primary);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
            animation: pulse 2s infinite;
        }
        
        .status-indicator.offline {
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }
        
        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .chat-message {
            padding: 15px 20px;
            border-radius: 12px;
            max-width: 75%;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .chat-message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #1e3a5f 0%, #2a4a6f 100%);
            border: 1px solid #3a5a7f;
        }
        
        .chat-message.ai {
            align-self: flex-start;
            background: linear-gradient(135deg, #0a2a1a 0%, #1a3a2a 100%);
            border: 1px solid #2a5a3a;
            color: #a0ffc0;
        }
        
        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 12px 18px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0,255,136,0.3);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: #000;
            box-shadow: 0 4px 15px rgba(0,255,136,0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,255,136,0.5);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #cc0000;
        }
        
        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid var(--border);
            color: var(--primary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }
        
        .table tr:hover {
            background: rgba(0,255,136,0.05);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .nav { padding: 0 15px; }
            .container { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° GODBRAIN QUANTUM - COMMAND CENTER</h1>
        <div class="header-status">
            <span class="status-badge status-online" id="system-status">‚óè OPERATIONAL</span>
            <span id="current-time"></span>
        </div>
    </div>
    
    <nav class="nav">
        <div class="nav-item active" data-page="dashboard">üìä Dashboard</div>
        <div class="nav-item" data-page="seraph">ü§ñ Seraph Control</div>
        <div class="nav-item" data-page="market">üìà Market Data</div>
        <div class="nav-item" data-page="system">‚öôÔ∏è System Status</div>
        <div class="nav-item" data-page="synthia">üß† Synthia Core</div>
        <div class="nav-item" data-page="logs">üìú Logs</div>
        <div class="nav-item" data-page="settings">üîß Settings</div>
    </nav>
    
    <div class="container">
        <!-- Dashboard Page -->
        <div class="page active" id="dashboard">
            <div class="grid grid-4">
                <div class="panel">
                    <div class="metric">
                        <div class="metric-value" id="price-display">$0</div>
                        <div class="metric-label">Market Price</div>
                    </div>
                </div>
                <div class="panel">
                    <div class="metric">
                        <div class="metric-value" id="strategy-display">OFFLINE</div>
                        <div class="metric-label">Active Strategy</div>
                    </div>
                </div>
                <div class="panel">
                    <div class="metric">
                        <div class="metric-value" id="redis-status">‚óè</div>
                        <div class="metric-label">Redis Status</div>
                    </div>
                </div>
                <div class="panel">
                    <div class="metric">
                        <div class="metric-value" id="seraph-status">‚óè</div>
                        <div class="metric-label">Seraph AI</div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-2" style="margin-top: 20px;">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">System Components</div>
                    </div>
                    <div class="panel-content" id="components-list">
                        <!-- Dynamic content -->
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">Quick Actions</div>
                    </div>
                    <div class="panel-content">
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="refreshAll()">üîÑ Refresh All</button>
                        <button class="btn btn-danger" style="width: 100%;" onclick="emergencyStop()">üõë Emergency Stop</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Seraph Control Page -->
        <div class="page" id="seraph">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Seraph AI Command Interface</div>
                </div>
                <div class="panel-content">
                    <div class="chat-container">
                        <div class="chat-messages" id="seraph-chat">
                            <div class="chat-message ai">SYSTEM: Seraph AI initialized. Ready for commands.</div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" class="chat-input" id="seraph-input" placeholder="Enter command (e.g., 'Activate Sniper', 'Show analysis')..." />
                            <button class="btn btn-primary" onclick="sendSeraphCommand()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Market Data Page -->
        <div class="page" id="market">
            <div class="grid grid-2">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">Live Price Feed</div>
                    </div>
                    <div class="panel-content">
                        <div class="metric">
                            <div class="metric-value" id="market-price">$0</div>
                            <div class="metric-label">BTC/USDT</div>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">Market Feed Status</div>
                    </div>
                    <div class="panel-content" id="feed-status">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Status Page -->
        <div class="page" id="system">
            <div class="grid grid-2">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">System Health</div>
                    </div>
                    <div class="panel-content" id="system-health">
                        <!-- Dynamic content -->
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">Component Status</div>
                    </div>
                    <div class="panel-content" id="component-status">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Synthia Core Page -->
        <div class="page" id="synthia">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Synthia Consciousness Core</div>
                </div>
                <div class="panel-content" id="synthia-status">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
        
        <!-- Logs Page -->
        <div class="page" id="logs">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">System Logs</div>
                </div>
                <div class="panel-content">
                    <div style="background: var(--bg-dark); padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 500px; overflow-y: auto;" id="logs-content">
                        Loading logs...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div class="page" id="settings">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">System Configuration</div>
                </div>
                <div class="panel-content">
                    <table class="table">
                        <tr>
                            <th>Setting</th>
                            <th>Value</th>
                        </tr>
                        <tr>
                            <td>Redis Host</td>
                            <td id="setting-redis-host">-</td>
                        </tr>
                        <tr>
                            <td>Redis Port</td>
                            <td id="setting-redis-port">-</td>
                        </tr>
                        <tr>
                            <td>Seraph Model</td>
                            <td id="setting-seraph-model">-</td>
                        </tr>
                        <tr>
                            <td>API Key Status</td>
                            <td id="setting-api-key">-</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                item.classList.add('active');
                document.getElementById(item.dataset.page).classList.add('active');
            });
        });
        
        // Time update
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // Data fetching
        async function fetchData() {
            try {
                const res = await fetch('/api/data');
                const data = await res.json();
                document.getElementById('price-display').textContent = '$' + data.price.toLocaleString();
                const strat = JSON.parse(data.strategy || '{}');
                document.getElementById('strategy-display').textContent = strat.version || 'OFFLINE';
                document.getElementById('market-price').textContent = '$' + data.price.toLocaleString();
            } catch(e) {
                console.error('Data fetch error:', e);
            }
        }
        
        async function fetchSystemStatus() {
            try {
                const res = await fetch('/api/system-status');
                const data = await res.json();
                
                // Update status indicators
                document.getElementById('redis-status').textContent = data.redis.connected ? '‚óè' : '‚óã';
                document.getElementById('seraph-status').textContent = data.seraph.online ? '‚óè' : '‚óã';
                
                // Update components list
                const components = document.getElementById('components-list');
                components.innerHTML = `
                    <div class="status-card">
                        <div class="status-indicator ${data.redis.connected ? '' : 'offline'}"></div>
                        <div>
                            <div style="font-weight: 600;">Redis</div>
                            <div style="font-size: 11px; color: var(--text-dim);">${data.redis.host}:${data.redis.port}</div>
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-indicator ${data.seraph.online ? '' : 'offline'}"></div>
                        <div>
                            <div style="font-weight: 600;">Seraph AI</div>
                            <div style="font-size: 11px; color: var(--text-dim);">${data.seraph.model}</div>
                        </div>
                    </div>
                `;
            } catch(e) {
                console.error('System status error:', e);
            }
        }
        
        async function fetchSynthiaStatus() {
            try {
                const res = await fetch('/api/synthia-status');
                const data = await res.json();
                const synthiaDiv = document.getElementById('synthia-status');
                synthiaDiv.innerHTML = `
                    <div class="status-card">
                        <div class="status-indicator ${data.core_active ? '' : 'offline'}"></div>
                        <div>
                            <div style="font-weight: 600;">Core Active</div>
                            <div style="font-size: 11px; color: var(--text-dim);">${data.core_active ? 'YES' : 'NO'}</div>
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-indicator ${data.tunnel_health ? '' : 'offline'}"></div>
                        <div>
                            <div style="font-weight: 600;">Tunnel Health</div>
                            <div style="font-size: 11px; color: var(--text-dim);">${data.tunnel_health ? 'HEALTHY' : 'UNHEALTHY'}</div>
                        </div>
                    </div>
                    <div class="status-card">
                        <div style="font-weight: 600;">Current Mode</div>
                        <div style="font-size: 14px; color: var(--primary); margin-top: 5px;">${data.current_mode}</div>
                    </div>
                `;
            } catch(e) {
                console.error('Synthia status error:', e);
            }
        }
        
        // Seraph commands
        async function sendSeraphCommand() {
            const input = document.getElementById('seraph-input');
            const chat = document.getElementById('seraph-chat');
            const cmd = input.value.trim();
            if (!cmd) return;
            
            input.value = '';
            // Bug fix: Use textContent to prevent XSS attacks
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = cmd;  // textContent automatically escapes HTML
            chat.appendChild(userMsg);
            chat.scrollTop = chat.scrollHeight;
            
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({command: cmd})
                });
                const data = await res.json();
                
                // Bug fix: Properly escape HTML while preserving newlines as <br>
                let response = data.response || '';
                const escapeHtml = (text) => {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                };
                // Convert newlines to <br> after escaping
                // Bug fix: Replace \r\n FIRST, then single \n, to handle Windows line endings correctly
                response = escapeHtml(response).replace(/\r\n/g, '<br>').replace(/\n/g, '<br>').replace(/\r/g, '<br>');
                
                const aiMsg = document.createElement('div');
                aiMsg.className = 'chat-message ai';
                aiMsg.innerHTML = response;  // Safe now - already escaped
                chat.appendChild(aiMsg);
                chat.scrollTop = chat.scrollHeight;
            } catch(e) {
                // Bug fix: Use textContent to prevent XSS attacks
                const errorMsg = document.createElement('div');
                errorMsg.className = 'chat-message ai';
                errorMsg.style.background = 'rgba(255,68,68,0.2)';
                errorMsg.style.borderColor = 'var(--danger)';
                errorMsg.textContent = `ERROR: ${e.message}`;
                chat.appendChild(errorMsg);
            }
        }
        
        document.getElementById('seraph-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendSeraphCommand();
        });
        
        // Refresh functions
        function refreshAll() {
            fetchData();
            fetchSystemStatus();
            fetchSynthiaStatus();
        }
        
        function emergencyStop() {
            if (confirm('üõë EMERGENCY STOP: T√ºm sistemler durdurulacak. Devam edilsin mi?')) {
                alert('Emergency stop activated. (Implementation needed)');
            }
        }
        
        // Auto-refresh
        setInterval(fetchData, 2000);
        setInterval(fetchSystemStatus, 5000);
        setInterval(fetchSynthiaStatus, 10000);
        
        // Initial load
        refreshAll();
    </script>
</body>
</html>

